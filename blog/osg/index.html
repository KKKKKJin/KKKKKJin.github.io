<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.css">
<meta name="google-site-verification" content="CZ8mgXA66moeAJ_qKYHPOC_cBCf2VaFdUZp2Xu7muyQ" />
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>The basic usage of OSG | Kejin Wu&#39;s Blog</title>
<meta name="keywords" content="Tech">
<meta name="description" content="an approach to run projects with PyTorch on OSG platform">
<meta name="author" content="Kejin Wu">
<link rel="canonical" href="https://KKKKKJin.github.io/blog/osg/"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c950b76eb8ed69a809f88c702277bbf002e1f619791af4968ade0aeeffe574c6.css" integrity="sha256-yVC3brjtaagJ&#43;IxwIne78ALh9hl5GvSWit4K7v/ldMY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://KKKKKJin.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://KKKKKJin.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://KKKKKJin.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://KKKKKJin.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://KKKKKJin.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://KKKKKJin.github.io/blog/osg/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-YN08Q4CNS1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-YN08Q4CNS1');
        }
      </script>
    
  

<meta property="og:title" content="The basic usage of OSG" />
<meta property="og:description" content="an approach to run projects with PyTorch on OSG platform" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://KKKKKJin.github.io/blog/osg/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-06-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-05-08T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The basic usage of OSG"/>
<meta name="twitter:description" content="an approach to run projects with PyTorch on OSG platform"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blog",
      "item": "https://KKKKKJin.github.io/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "The basic usage of OSG",
      "item": "https://KKKKKJin.github.io/blog/osg/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "The basic usage of OSG",
  "name": "The basic usage of OSG",
  "description": "an approach to run projects with PyTorch on OSG platform",
  "keywords": [
    "Tech"
  ],
  "articleBody": "Acknowledgement Thanks to Weiwei for the first introduction of OSG to me and constructive suggestions to this tutorial article.\nSome codes in this article are written with the help from ChatGPT. Thanks!\nThis article is indicated to describe the whole process of performing jobs on OSG. More specifically, it takes running a Python project with PyTorch environment as an example. All commands here serve for Mac OS system. In short, we will introduce:\nHow to sign-up and access OSG How to set up the necessary environment on OSG How to prepare, submit, run and monitor jobs on OSG How to collect results from OSG to local Due to the specific design of OSG, it is pretty powerful to run tasks which can be performed parallelly. For example, in the area of statistics, people usually need to do some kind of simulations to advocate their methods. However, due to the randomness, the simulation procedure usually need to be repeated many times. In this case, OSG can render much convenience since it can handle hundreds simulation replications meanwhile. Moreover, for each replication, we can further run it parallelly with multiple CPUs.\nImagine we submit 1000 jobs to OSG and each job will run with 4 CPUs, i.e., 4000 CPUs will run together for our tasks.\nIntroduction of the Open Science Grid platform The Open Science Grid (OSG) consists of unused computing and storage resources at universities and national labs spanning the United States. Participators can submit their tasks to OSG through the Open Science Pool. However, each jobs should fit on a single server; see Page to learn the appropriate size of job for running smoothly on OSG.\nSign up for OSG account If you are a researcher affiliated with a US Academic Institution, just go to Link to sign up for the usage of OSG. In short, you need to fulfill the reason of applying the OSG usage and then someone from the OSG team will set up a meeting with you to give more detailed introduction about OSG and create an account for you.\nAccess to OSG from local Once you have met with OSG team member, you will have an account set up to access OSG. There are two steps to make the connection between your local computer and the OSG:\nCreate a SSH key; see Page for the simple way to create a SSH key. If the folder name which stores the SSH key is ssh. You can run the code follows in terminal to open the ssh folder: cd ~/.ssh Then, a simple command below can list all SSH keys stored in your local computer.\nls To get a specific SSH key info, use the below code but replace the name with the actual file name.\ncat name.pub Lastly, we need to add a this SSH key info to our web profile in OSG Page; see more details about this process from Page.\nAdd the two-factor authentication; see Page for more details. (I used the Google Authenticator to be the second authentication) Finally, we are ready to access OSG from local. Type the below code in terminal, but replace UnixUsername with your own UnixUsername read from Profile on Page. Also, please replace loginnode with the true login node assigned to you:\nssh UnixUsername@loginnode Then, you need to enter the passphrase which you defined when the SSH key is created. Also, you need to pass the second authentication.\nSet up the environment Once we are able to access OSG, the next step is to run our jobs. Since the OSG provides the computation resources collected from different places, we need to specify the environment in which our jobs will run upon. For example, we shall indicate which packages we require. There are some existing environment provided by OSG using containers; see Page. Unfortunately, these basic environments may not satisfy our need. Thus, we need to set up our own environment.\nIn this article, we introduce the method to create the desired environment through compiling an image based on a docker file. First, please install the Docker from Page. Then, we can check the if the installation is successful by running below code in terminal\ndocker --version Then, we need to write a docker file (.txt file) to state which packages we need. A docker file template looks like below:\n# Use an official Python runtime as a parent image FROM --platform=linux/amd64 python:3.8-slim # Set environment variables ENV PYTHONDONTWRITEBYTECODE=1 \\ PYTHONUNBUFFERED=1 \\ PIP_NO_CACHE_DIR=off \\ PIP_DISABLE_PIP_VERSION_CHECK=on \\ PIP_DEFAULT_TIMEOUT=100 # Install system dependencies RUN apt-get update \\ \u0026\u0026 apt-get install -y --no-install-recommends \\ git \\ build-essential \\ libglib2.0-0 \\ libsm6 \\ libxext6 \\ libxrender-dev \\ wget \\ \u0026\u0026 rm -rf /var/lib/apt/lists/* # Install PyTorch and other packages RUN python3 -m pip install torch joblib pandas scikit-learn numpy # Set the working directory in the container WORKDIR /app # Copy the current directory contents into the container at /app COPY . /app First line FROM --platform=linux/amd64 python:3.8-slim is important which indicates that we require an environment built in amd64 structure. (Mac will adopt another structure without this line due to the ARM-based M chip)\nThe line RUN python3 -m pip install torch joblib pandas sklearn gives a list of needed packages. Here, joblib is a package used to run code parallelly with multiple CPUs. You can add additional necessary packages following the list.\nHow to check the built-in libraries in Python will be explained later.\nSubsequently, we can build the container image which will be provided as the environment later by the command below. (note you need to be in the folder which contains the docker file; use the command cd)\ndocker build -t namespace/repository_name . For the namespace, you can use your own Docker account name. For repository_name, you can give any distinguishable name. For this moment, I am creating an environment for CalibrationPI project, so I will use command, e.g., docker build -t user/calibrationpi .. You can replace user with your own user name.\nAfter the building, you should be able to see the Image ID by the command below:\ndocker image list Then, we need to transfer the Docker image to the OSG. First, let’s compress this image to a .tar file by the command below:\ndocker save Image ID -o file name.tar Replace Image ID with the image ID you found with docker image list. You can specify any file name.\nSince the image file is usually larger than 1 GB, we need to transfer it to Open Science Data Federation (OSDF); the location of OSDF for different login node can be found on this Page. For example, my login group is ap21 and my UnixUsername is user. Thus, the location in which we should transfer image to is /ospool/ap21/data/user. We can accomplish the transfer by the code below:\nscp calibrationpi.tar user@ap21.uc.osg-htc.org:/ospool/ap21/data/user Remember to replace user in above command with your own UnixUsername and use your login node.\nThen, we need login the OSG and go the location /ospool/ap21/data/user where we put the docker image in. Use the below command, we can convert the docker image to SIF image:\napptainer build filename.sif docker-archive://file name.tar Here, file name.tar is the .tar file compressed before. After building SIF image, you can see .sif file in this folder by ls command. This .sig file will be specified when we write the submit file on OSG.\nLast step, we shall check if the packages have been installed successfully. Open the filename.sif by command:\napptainer shell pytorch-2.1.1.sif Then, open python by command:\npython Check if torch was installed successfully by command:\nimport torch After check, use exit() to exit python and exit to exit image.\nPrepare, submit, run and monitor jobs on OSG In this part, we apply a simple simulation task to illustrate how shall we prepare and run jobs on OSG.\nLet’s say we want to simulate 100 samples from each normal distribution $N(\\mu_i,1)$ for $i = 1,\\ldots, K$. Then, we can use the sample mean of each simulated data to approximate $\\mu_i$. However, this sample mean only stands for a single point estimation. We could re-do such simulation procedure $M$ times and use the empirical distribution of these $M$ number of observed sample mean to approximate the sampling distribution of the sample mean. In other words, we hope to simulate 100 data $M$ time for all $\\mu_i,~ i=1,\\ldots, K$.\nIn practice, we may face a much more complicated simulation which needed to be replicated many times and with different parameters. The logic to achieve a more changeling task is similar as this toy example.\nWe first prepare a main.py file which is the main body to solve the aforementioned simulation problem.\nimport sys import torch import os import torch def main(i, ii): new_folder_name = './example_mean' + f'{i}' os.makedirs(new_folder_name) torch.manual_seed(ii) Single_sim = i + 1 * torch.randn(100) torch.save(Single_sim, new_folder_name + '/Simulation_Rep'+ f'{ii}' + '.pth') if __name__ == \"__main__\": # Check if an argument is passed if len(sys.argv) \u003e 1: mean = sys.argv[1] # Get the mean value from input iteration = sys.argv[2] # Get the iteration number from input main(mean, iteration) else: print(\"No iteration number provided.\") main(i, ii) takes two inputs. $i$ represents the mean is equal to $i$; $ii$ represents the $ii$-th replication.\ntorch.manual_seed(ii) set the seed as the same as the replication index to make this experiment reproducible.\nnew_folder_name = './example_mean' + f'{i}' creates a folder for each mean value to store all simulations.\ntorch.save(Single_sim, new_folder_name + '/Simulation_Rep'+ f'{ii}' + '.pth') saves each simulation with its corresponding mean value to the specific path.\nsys.argv[1] and sys.argv[2] read two inputs given by our submission.\nFor a more complicated project, main function may depend on other functions. We can write these auxiliary functions separately and import them to the main.py by command like from Other_functions import *.\nThen, we need to prepare a .sh file to tell the server on OSG to execute the main.py.\n# Assign passed arguments to variables # var1 stands for the mean # var2 stands for the replication index var1 = \"$1\" var2 = \"$2\" # Use the variables to run your Python script python3 main.py $var1 $var2 Lastly, we need to prepare a submission file to submit all simulations with different mean to OSG. Let’s name the file by Submission.sub\n+SingularityImage = \"osdf:///ospool/login code/data/UnixUsername/filename.sif\" executable = shell.sh arguments = $(mean) $(inde) transfer_input_files = main.py, Other_functions.py transfer_output_files = example_mean$(mean) log = example_mean_logs/example_mean$(mean)_$(inde).log error = example_mean_errors/example_mean$(mean)_$(inde).err output = example_mean_outputs/example_mean$(mean)_$(inde).out +JobDurationCategory = \"Long\" request_cpus = 1 request_memory = 1GB request_disk = 4GB requirements = (Microarch \u003e= \"x86_64-v3\") queue mean inde from Example.txt +SingularityImage = \"osdf:///ospool/logincode/data/UnixUsername/filename.sif\" indicates which environment (i.e., .sif image) we want to use. You can replcae logincode, UnixUsername and filename.sif with your information.\ntransfer_input_files = main.py, Other_functions.py indicates we need main.py and other possible auxiliary functions. If you do not have Other_functions.py, just remove it.\ntransfer_output_files = example_mean$(mean) indicates the final result we hope the OSG collects from all servers and return to our. For here, we hope to return all folders we built in main.py.\nlog = example_mean_logs/example_mean$(mean)_$(inde).log collects all running information for each job.\nerror = example_mean_errors/example_mean$(mean)_$(inde).err collects all running errors for each job.\noutput = example_mean_outputs/example_mean$(mean)_$(inde).out collects all running outputs for each job.\n+JobDurationCategory = \"Long\" indicates the possible running time of each job; see Page for more introduction.\nrequest_cpus = 1 request one cpu for each single simulation; request_memory = 1GB request 1GB memory; request_disk = 4GB request 4GB disk.\nrequirements = (Microarch \u003e= \"x86_64-v3\") restricts the server model we want to use.\nqueue mean inde from Example.txt extracts all mean values and replication indices from Example.txt. If we take $\\mu_1 = 1, \\mu_2 = 2$ which means $K = 2$; take $M = 2$. Then Example.txt shall have below format\n1 0 1 1 2 0 2 1 These are all files we need to prepare. Then, we can transfer all such files to OSG. And we are ready to run them.\nWe can put all files in a single folder Example_blog and then use the below command with our local terminal to transfer all of them to OSG platform (make sure we are in the path of the folder in terminal)\nscp -r Example_blog UnixUsername@loginnode:/home/UnixUsername Open another terminal in local and connect to OSG with command ssh UnixUsername@loginnode. Then, we can see the folder Example_blog by command ls. Use cd Example_blog to open the folder. Use ls again, we can see all files. However, we need create one more folder to store the .log files generated from the running process. The step can be accomplished by command:\nmkdir -p example_mean_logs Finally, we can use blow code to submit our four jobs to OSG\ncondor_submit Simulation.sub Then, with command condor_q, we can see the status of our submitted jobs. You can consider other commands, e.g., condor_watch_q, watch condor_q. Sometimes, the job will be held due to many complicated issues. If you are sure your submission is accurate, you can just condor_release the job ID to resubmit all held jobs. Once the submission is finished, we can compress the whole folder together and then transfer the compressed folder to our local:\ntar -czvf Example_blog.tar.gz Example_blog Then, run below command in a local terminal to get the compressed folder from OSG:\nscp -r UnixUsername@loginnode:/home/UnixUsername/Example_blog.tar.gz /local_path Please replace UnixUsername, loginnode and local_path with your choices.\nOthers Once we have all .pth files in our local system, we can read all .pth files and store them in a list by a simple way.\nimport torch import glob directory = '/local_path' # Get a list of .pth files in the directory pth_files = glob.glob(f'{directory}/*.pth') n_res = len(pth_files) All_sim_res = [None] * n_res i = 0 for pth_file in pth_files: All_sim_res[i] = torch.load(pth_file) i += 1 Remember to replace '/local_path with your own pth in which all .pth files are stored.\nThis is my first tech blog. Thank you for reading! Let me know if you have any questions or comments! 💫\n",
  "wordCount" : "2315",
  "inLanguage": "en",
  "datePublished": "2024-06-22T00:00:00Z",
  "dateModified": "2024-05-08T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Kejin Wu"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://KKKKKJin.github.io/blog/osg/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Kejin Wu's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://KKKKKJin.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://KKKKKJin.github.io/" accesskey="h" title="Kejin Wu&#39;s Blog (Alt + H)">
                <img src="https://KKKKKJin.github.io/favicon.ico" alt="" aria-label="logo"
                    height="18"
                    width="18">Kejin Wu&#39;s Blog</a>
            <div class="logo-switches">
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="https://KKKKKJin.github.io/zh/" title="Chinese"
                            aria-label="中文">中文</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://KKKKKJin.github.io/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">
<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      The basic usage of OSG
    </h1>
    <div class="post-meta"><span title='2024-06-22 00:00:00 +0000 UTC'>June 22, 2024</span>&nbsp;·&nbsp;Kejin Wu

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#acknowledgement">Acknowledgement</a></li>
    <li><a href="#introduction-of-the-open-science-grid-platform">Introduction of the Open Science Grid platform</a></li>
    <li><a href="#sign-up-for-osg-account">Sign up for OSG account</a></li>
    <li><a href="#access-to-osg-from-local">Access to OSG from local</a></li>
    <li><a href="#set-up-the-environment">Set up the environment</a></li>
    <li><a href="#prepare-submit-run-and-monitor-jobs-on-osg">Prepare, submit, run and monitor jobs on OSG</a></li>
    <li><a href="#others">Others</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="acknowledgement">Acknowledgement<a hidden class="anchor" aria-hidden="true" href="#acknowledgement">#</a></h2>
<blockquote>
<p><em>Thanks to <a href="https://sites.google.com/view/weiwei-wu/">Weiwei</a> for the first introduction of OSG to me and constructive suggestions to this tutorial article.</em></p>
</blockquote>
<blockquote>
<p><em>Some codes in this article are written with the help from ChatGPT. Thanks!</em></p>
</blockquote>
<hr>
<p>This article is indicated to describe the whole process of performing jobs on OSG. More specifically, it takes running a Python project with PyTorch environment as an example. All commands here serve for Mac OS system. In short, we will introduce:</p>
<ul>
<li>How to sign-up and access OSG</li>
<li>How to set up the necessary environment on OSG</li>
<li>How to prepare, submit, run and monitor jobs on OSG</li>
<li>How to collect results from OSG to local</li>
</ul>
<p>Due to the specific design of OSG, it is pretty powerful to run tasks which can be performed parallelly. For example, in the area of statistics, people usually need to do some kind of simulations to advocate their methods. However, due to the randomness, the simulation procedure usually need to be repeated many times. In this case, OSG can render much convenience since it can handle hundreds simulation replications meanwhile. Moreover, for each replication, we can further run it parallelly with multiple CPUs.</p>
<p>Imagine we submit 1000 jobs to OSG and each job will run with 4 CPUs, i.e., 4000 CPUs will run together for our tasks.</p>
<hr>
<h2 id="introduction-of-the-open-science-grid-platform">Introduction of the Open Science Grid platform<a hidden class="anchor" aria-hidden="true" href="#introduction-of-the-open-science-grid-platform">#</a></h2>
<p>The Open Science Grid (OSG) consists of unused computing and storage resources at universities and national labs spanning the United States. Participators can submit their tasks to OSG through the Open Science Pool. However, each jobs should fit on a single server; see <a href="https://osg-htc.org/services/open_science_pool.html">Page</a> to learn the appropriate size of job for running smoothly on OSG.</p>
<h2 id="sign-up-for-osg-account">Sign up for OSG account<a hidden class="anchor" aria-hidden="true" href="#sign-up-for-osg-account">#</a></h2>
<p>If you are a researcher affiliated with a US Academic Institution, just go to <a href="https://portal.osg-htc.org/application">Link</a> to sign up for the usage of OSG. In short, you need to fulfill the reason of applying the OSG usage and then someone from the OSG team will set up a meeting with you to give more detailed introduction about OSG and create an account for you.</p>
<h2 id="access-to-osg-from-local">Access to OSG from local<a hidden class="anchor" aria-hidden="true" href="#access-to-osg-from-local">#</a></h2>
<p>Once you have met with OSG team member, you will have an account set up to access OSG. There are two steps to make the connection between your local computer and the OSG:</p>
<ol>
<li>Create a SSH key; see <a href="https://portal.osg-htc.org/documentation/overview/account_setup/generate-add-sshkey/">Page</a> for the simple way to create a SSH key. If the folder name which stores the SSH key is <strong>ssh</strong>.
You can run the code follows in terminal to open the <strong>ssh</strong> folder:</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.ssh
</span></span></code></pre></div><p>Then, a simple command below can list all SSH keys stored in your local computer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls
</span></span></code></pre></div><p>To get a specific SSH key info, use the below code but replace the <code>name</code> with the actual file name.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat name.pub
</span></span></code></pre></div><p>Lastly, we need to add a this SSH key info to our web profile in OSG <a href="https://www.osgconnect.net/">Page</a>; see more details about this process from <a href="https://portal.osg-htc.org/documentation/overview/account_setup/connect-access/">Page</a>.</p>
<ol start="2">
<li>Add the two-factor authentication; see <a href="https://portal.osg-htc.org/documentation/overview/account_setup/connect-access/">Page</a> for more details. (I used the Google Authenticator to be the second authentication)</li>
</ol>
<p>Finally, we are ready to access OSG from local. Type the below code in terminal, but replace <code>UnixUsername</code> with your own UnixUsername read from Profile on <a href="https://www.osgconnect.net/">Page</a>. Also, please replace <code>loginnode</code> with the true login node assigned to you:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh UnixUsername@loginnode
</span></span></code></pre></div><p>Then, you need to enter the passphrase which you defined when the SSH key is created. Also, you need to pass the second authentication.</p>
<h2 id="set-up-the-environment">Set up the environment<a hidden class="anchor" aria-hidden="true" href="#set-up-the-environment">#</a></h2>
<p>Once we are able to access OSG, the next step is to run our jobs. Since the OSG provides the computation resources collected from different places, we need to specify the environment in which our jobs will run upon. For example, we shall indicate which packages we require. There are some existing environment provided by OSG using containers; see <a href="https://portal.osg-htc.org/documentation/htc_workloads/using_software/available-containers-list/">Page</a>. Unfortunately, these basic environments may not satisfy our need. Thus, we need to set up our own environment.</p>
<p>In this article, we introduce the method to create the desired environment through compiling an image based on a docker file. First, please install the <strong>Docker</strong> from <a href="https://www.docker.com/">Page</a>. Then, we can check the if the installation is successful by running below code in terminal</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker --version
</span></span></code></pre></div><p>Then, we need to write a docker file (<strong>.txt file</strong>) to state which packages we need. A docker file template looks like below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Use an official Python runtime as a parent image</span>
</span></span><span class="line"><span class="cl">FROM --platform<span class="o">=</span>linux/amd64 python:3.8-slim
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set environment variables</span>
</span></span><span class="line"><span class="cl">ENV <span class="nv">PYTHONDONTWRITEBYTECODE</span><span class="o">=</span><span class="m">1</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PYTHONUNBUFFERED</span><span class="o">=</span><span class="m">1</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PIP_NO_CACHE_DIR</span><span class="o">=</span>off <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="o">=</span>on <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PIP_DEFAULT_TIMEOUT</span><span class="o">=</span><span class="m">100</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install system dependencies</span>
</span></span><span class="line"><span class="cl">RUN apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y --no-install-recommends <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        git <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        build-essential <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        libglib2.0-0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        libsm6 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        libxext6 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        libxrender-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Install PyTorch and other packages</span>
</span></span><span class="line"><span class="cl">RUN python3 -m pip install torch joblib pandas scikit-learn numpy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set the working directory in the container</span>
</span></span><span class="line"><span class="cl">WORKDIR /app
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Copy the current directory contents into the container at /app</span>
</span></span><span class="line"><span class="cl">COPY . /app
</span></span></code></pre></div><p>First line <code>FROM --platform=linux/amd64 python:3.8-slim</code> is important which indicates that we require an environment built in <code>amd64</code> structure. (Mac will adopt another structure without this line due to the ARM-based M chip)</p>
<p>The line <code>RUN python3 -m pip install torch joblib pandas sklearn</code> gives a list of needed packages. Here, <code>joblib</code> is a package used to run code parallelly with multiple CPUs. You can add additional necessary packages following the list.</p>
<p>How to check the built-in libraries in Python will be explained later.</p>
<p>Subsequently, we can build the container image which will be provided as the environment later by the command below. (note you need to be in the folder which contains the docker file; use the command <code>cd</code>)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build -t namespace/repository_name .
</span></span></code></pre></div><p>For the <code>namespace</code>, you can use your own <strong>Docker</strong> account name. For <code>repository_name</code>, you can give any distinguishable name. For this moment, I am creating an environment for CalibrationPI project, so I will use command, e.g., <code>docker build -t user/calibrationpi .</code>. You can replace <code>user</code> with your own user name.</p>
<p>After the building, you should be able to see the Image ID by the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker image list
</span></span></code></pre></div><p>Then, we need to transfer the Docker image to the OSG. First, let&rsquo;s compress this image to a <code>.tar</code> file by the command below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker save Image ID -o file name.tar
</span></span></code></pre></div><p>Replace <code>Image ID</code> with the image ID you found with <code>docker image list</code>. You can specify any <code>file name</code>.</p>
<p>Since the image file is usually larger than 1 GB, we need to transfer it to Open Science Data Federation (OSDF); the location of OSDF for different login node can be found on this <a href="https://portal.osg-htc.org/documentation/htc_workloads/managing_data/osdf/">Page</a>. For example, my login group is <code>ap21</code> and my UnixUsername is <code>user</code>. Thus, the location in which we should transfer image to is <code>/ospool/ap21/data/user</code>. We can accomplish the transfer by the code below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scp calibrationpi.tar user@ap21.uc.osg-htc.org:/ospool/ap21/data/user
</span></span></code></pre></div><p>Remember to replace <code>user</code> in above command with your own UnixUsername and use your login node.</p>
<p>Then, we need login the OSG and go the location <code>/ospool/ap21/data/user</code> where we put the docker image in. Use the below command, we can convert the docker image to SIF image:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apptainer build filename.sif docker-archive://file name.tar
</span></span></code></pre></div><p>Here, <code>file name.tar</code> is the <code>.tar</code> file compressed before. After building SIF image,  you can see <code>.sif</code> file in this folder by <code>ls</code> command. This <code>.sig</code> file will be specified when we write the submit file on OSG.</p>
<p>Last step, we shall check if the packages have been installed successfully. Open the <code>filename.sif</code> by command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apptainer shell pytorch-2.1.1.sif
</span></span></code></pre></div><p>Then, open python by command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python
</span></span></code></pre></div><p>Check if <code>torch</code> was installed successfully by command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">import torch
</span></span></code></pre></div><p>After check, use <code>exit()</code> to exit python and <code>exit</code> to exit image.</p>
<h2 id="prepare-submit-run-and-monitor-jobs-on-osg">Prepare, submit, run and monitor jobs on OSG<a hidden class="anchor" aria-hidden="true" href="#prepare-submit-run-and-monitor-jobs-on-osg">#</a></h2>
<blockquote>
<p>In this part, we apply a simple simulation task to illustrate how shall we prepare and run jobs on OSG.</p>
</blockquote>
<blockquote>
<p>Let&rsquo;s say we want to simulate 100 samples from each normal distribution $N(\mu_i,1)$ for $i = 1,\ldots, K$. Then, we can use the sample mean of each simulated data to approximate $\mu_i$. However, this sample mean only stands for a single point estimation. We could re-do such simulation procedure $M$ times and use the empirical distribution of these $M$ number of observed sample mean to approximate the sampling distribution of the sample mean. In other words, we hope to simulate 100 data $M$ time for all $\mu_i,~ i=1,\ldots, K$.</p>
</blockquote>
<blockquote>
<p>In practice, we may face a much more complicated simulation which needed to be replicated many times and with different parameters. The logic to achieve a more changeling task is similar as this toy example.</p>
</blockquote>
<blockquote>
<p>We first prepare a <code>main.py</code> file which is the main body to solve the aforementioned simulation problem.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ii</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">new_folder_name</span> <span class="o">=</span> <span class="s1">&#39;./example_mean&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">new_folder_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Single_sim</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Single_sim</span><span class="p">,</span> <span class="n">new_folder_name</span> <span class="o">+</span> <span class="s1">&#39;/Simulation_Rep&#39;</span><span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ii</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;.pth&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if an argument is passed</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">mean</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Get the mean value from input</span>
</span></span><span class="line"><span class="cl">        <span class="n">iteration</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># Get the iteration number from input</span>
</span></span><span class="line"><span class="cl">        <span class="n">main</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No iteration number provided.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p><code>main(i, ii)</code> takes two inputs. $i$ represents the mean is equal to $i$; $ii$ represents the $ii$-th replication.</p>
<p><code>torch.manual_seed(ii)</code> set the seed as the same as the replication index to make this experiment reproducible.</p>
<p><code>new_folder_name = './example_mean' + f'{i}' </code> creates a folder for each mean value to store all simulations.</p>
<p><code>torch.save(Single_sim, new_folder_name + '/Simulation_Rep'+ f'{ii}' + '.pth')</code> saves each simulation with its corresponding mean value to the specific path.</p>
<p><code>sys.argv[1]</code> and <code>sys.argv[2]</code> read two inputs given by our submission.</p>
<p>For a more complicated project, <code>main</code> function may depend on other functions. We can write these auxiliary functions separately and import them to the <code>main.py</code> by command like <code>from Other_functions import *</code>.</p>
<blockquote>
<p>Then, we need to prepare a <code>.sh</code> file to tell the server on OSG to execute the <code>main.py</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Assign passed arguments to variables</span>
</span></span><span class="line"><span class="cl"><span class="c1"># var1 stands for the mean</span>
</span></span><span class="line"><span class="cl"><span class="c1"># var2 stands for the replication index</span>
</span></span><span class="line"><span class="cl"><span class="nv">var1</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">var2</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Use the variables to run your Python script</span>
</span></span><span class="line"><span class="cl">python3 main.py <span class="nv">$var1</span> <span class="nv">$var2</span>
</span></span></code></pre></div><blockquote>
<p>Lastly, we need to prepare a submission file to submit all simulations with different mean to OSG. Let&rsquo;s name the file by <code>Submission.sub</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">+SingularityImage <span class="o">=</span> <span class="s2">&#34;osdf:///ospool/login code/data/UnixUsername/filename.sif&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">executable</span> <span class="o">=</span> shell.sh
</span></span><span class="line"><span class="cl"><span class="nv">arguments</span> <span class="o">=</span> <span class="k">$(</span>mean<span class="k">)</span> <span class="k">$(</span>inde<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">transfer_input_files</span> <span class="o">=</span>  main.py, Other_functions.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">transfer_output_files</span> <span class="o">=</span> example_mean<span class="k">$(</span>mean<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">log</span> <span class="o">=</span> example_mean_logs/example_mean<span class="k">$(</span>mean<span class="k">)</span>_<span class="k">$(</span>inde<span class="k">)</span>.log
</span></span><span class="line"><span class="cl"><span class="nv">error</span> <span class="o">=</span> example_mean_errors/example_mean<span class="k">$(</span>mean<span class="k">)</span>_<span class="k">$(</span>inde<span class="k">)</span>.err
</span></span><span class="line"><span class="cl"><span class="nv">output</span> <span class="o">=</span> example_mean_outputs/example_mean<span class="k">$(</span>mean<span class="k">)</span>_<span class="k">$(</span>inde<span class="k">)</span>.out
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">+JobDurationCategory <span class="o">=</span> <span class="s2">&#34;Long&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">request_cpus</span> <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">request_memory</span> <span class="o">=</span> 1GB
</span></span><span class="line"><span class="cl"><span class="nv">request_disk</span> <span class="o">=</span> 4GB
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">requirements</span> <span class="o">=</span> <span class="o">(</span>Microarch &gt;<span class="o">=</span> <span class="s2">&#34;x86_64-v3&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">queue mean inde from Example.txt
</span></span></code></pre></div><p><code>+SingularityImage = &quot;osdf:///ospool/logincode/data/UnixUsername/filename.sif&quot;</code> indicates which environment (i.e., <code>.sif</code> image) we want to use. You can replcae <code>logincode</code>, <code>UnixUsername</code> and <code>filename.sif</code> with your information.</p>
<p><code>transfer_input_files =  main.py, Other_functions.py</code> indicates we need <code>main.py</code> and other possible auxiliary  functions. If you do not have <code>Other_functions.py</code>, just remove it.</p>
<p><code>transfer_output_files = example_mean$(mean)</code> indicates the final result we hope the OSG collects from all servers and return to our. For here, we hope to return all folders we built in <code>main.py</code>.</p>
<p><code>log = example_mean_logs/example_mean$(mean)_$(inde).log</code> collects all running information for each job.</p>
<p><code>error = example_mean_errors/example_mean$(mean)_$(inde).err</code>  collects all running errors for each job.</p>
<p><code>output = example_mean_outputs/example_mean$(mean)_$(inde).out</code> collects all running outputs for each job.</p>
<p><code>+JobDurationCategory = &quot;Long&quot;</code> indicates the possible running time of each job; see <a href="https://portal.osg-htc.org/documentation/htc_workloads/workload_planning/jobdurationcategory/">Page</a> for more introduction.</p>
<p><code>request_cpus = 1</code> request one cpu for each single simulation; <code>request_memory = 1GB</code> request 1GB memory; <code>request_disk = 4GB</code> request 4GB disk.</p>
<p><code>requirements = (Microarch &gt;= &quot;x86_64-v3&quot;)</code> restricts the server model we want to use.</p>
<p><code>queue mean inde from Example.txt</code> extracts all mean values and replication indices from <code>Example.txt</code>. If we take $\mu_1 = 1, \mu_2 = 2$ which means $K = 2$; take $M = 2$. Then <code>Example.txt</code> shall have below format</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">1</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span> <span class="m">1</span>
</span></span></code></pre></div><blockquote>
<p>These are all files we need to prepare. Then, we can transfer all such files to OSG. And we are ready to run them.</p>
</blockquote>
<p>We can put all files in a single folder <code>Example_blog</code> and then use the below command with our local terminal to transfer all of them to OSG platform (make sure we are in the path of the folder in terminal)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scp -r Example_blog UnixUsername@loginnode:/home/UnixUsername
</span></span></code></pre></div><p>Open another terminal in local and connect to OSG with command <code>ssh UnixUsername@loginnode</code>. Then, we can see the folder <code>Example_blog</code> by command <code>ls</code>. Use <code>cd Example_blog</code> to open the folder. Use <code>ls</code> again, we can see all files. However, we need create one more folder to store the <code>.log</code> files generated from the running process. The step can be accomplished by command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p example_mean_logs
</span></span></code></pre></div><p>Finally, we can use blow code to submit our four jobs to OSG</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">condor_submit Simulation.sub
</span></span></code></pre></div><p>Then, with command <code>condor_q</code>, we can see the status of our submitted jobs. You can consider other commands, e.g., <code>condor_watch_q</code>, <code>watch condor_q</code>. Sometimes, the job will be held due to many complicated issues. If you are sure your submission is accurate, you can just <code>condor_release</code> the job ID to resubmit all held jobs. Once the submission is finished, we can compress the whole folder together and then transfer the compressed folder to our local:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tar -czvf Example_blog.tar.gz Example_blog
</span></span></code></pre></div><p>Then, run below command in a <em>local</em> terminal to get the compressed folder from OSG:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">scp -r UnixUsername@loginnode:/home/UnixUsername/Example_blog.tar.gz /local_path
</span></span></code></pre></div><p>Please replace <code>UnixUsername</code>, <code>loginnode</code> and <code>local_path</code> with your choices.</p>
<h2 id="others">Others<a hidden class="anchor" aria-hidden="true" href="#others">#</a></h2>
<p>Once we have all <code>.pth</code> files in our local system, we can read all <code>.pth</code> files and store them in a list by a simple way.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">glob</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">directory</span> <span class="o">=</span> <span class="s1">&#39;/local_path&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get a list of .pth files in the directory</span>
</span></span><span class="line"><span class="cl"><span class="n">pth_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s1">/*.pth&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">n_res</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pth_files</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">All_sim_res</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_res</span>
</span></span><span class="line"><span class="cl"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">pth_file</span> <span class="ow">in</span> <span class="n">pth_files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">All_sim_res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pth_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span></code></pre></div><p>Remember to replace <code>'/local_path</code> with your own pth in which all <code>.pth</code> files are stored.</p>
<hr>
<p>This is my first tech blog. Thank you for reading! Let me know if you have any questions or comments! 💫</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://KKKKKJin.github.io/tags/tech/">Tech</a></li>
    </ul>
    
    
    <h4>Comments:</h4>
    <div id="cusdis_thread" data-host="https://cusdis.com"
      data-app-id="c4064966-0290-4be4-87f6-dd0cce9f06ed"
      data-page-id="30879ae7dce27c1c6d61f77480372331" data-page-url="https://KKKKKJin.github.io/blog/osg/"
      data-lang="en"
      data-page-title="The basic usage of OSG"></div>
      
    
      <script async defer src="https://cusdis.com/js/cusdis.es.js"></script> 
    
  </footer>

</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://KKKKKJin.github.io/">Kejin Wu&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        Total visits<span id="busuanzi_value_site_pv"></span> times 
    </span>
    <span id="busuanzi_container_site_uv">
        Total viewers<span id="busuanzi_value_site_uv"></span> people
    </span>
    </div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>



<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "$", right: "$", display: false}
      ]
    });
  });
</script>

</body>

</html>
